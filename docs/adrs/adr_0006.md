---
title: "Git Notes as Primary Persistence"
description: "Original decision to use git notes for memory persistence, later superseded by ADR-0047 due to critical data overwrite bug."
type: adr
category: storage
tags:
  - git-notes
  - persistence
  - storage
  - superseded
  - version-control
status: deprecated
created: 2025-12-28
updated: 2026-01-15
author: Claude (Architect)
project: subcog
related:
  - docs/adrs/adr_0047.md
technologies:
  - git
  - git-notes
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0006: Git Notes as Primary Persistence

## Status

**Superseded** by [ADR-0047](adr_0047.md)

> **Note**: This ADR was superseded on 2026-01-03 by ADR-0047 (Remove Git-Notes Storage Layer) due to a critical bug where git notes would overwrite previous memories.

## Context

Memory storage needs:

- Durability
- Version history
- Remote synchronization
- Merge capability

## Decision Drivers

### Primary Decision Drivers

1. **Version Control Integration**: Memories should integrate naturally with git workflows since developers already use git for code.

2. **Remote Synchronization**: Git's built-in push/pull mechanisms provide free synchronization without custom infrastructure.

3. **Local-First Architecture**: Git notes store data locally with optional remote sync, matching Subcog's offline-first design.

### Secondary Decision Drivers

1. **Existing Tooling**: Git is universally available on developer machines.

2. **Atomic Operations**: Git provides atomic commits for data integrity.

## Considered Options

### Option 1: SQLite with custom sync

**Description**: Use SQLite as the persistence layer with a custom synchronization implementation.

**Advantages**:
- ACID transactions
- Fast queries
- Single file

**Disadvantages**:
- Custom sync implementation needed
- No built-in version history

**Why Not Selected**: Required building custom synchronization infrastructure.

### Option 2: Git notes (Originally Selected)

**Description**: Use git notes attached to commits for memory persistence.

**Advantages**:
- Built-in version history
- Free remote sync via git push/pull

**Disadvantages**:
- Performance at scale
- Complex merge conflicts

**Why Selected**: Provided built-in versioning and synchronization with minimal infrastructure.

**Why Later Superseded**: Critical bug discovered where `force=true` flag caused data overwrites.

### Option 3: PostgreSQL

**Description**: Use PostgreSQL as a centralized database for memory storage.

**Advantages**:
- Scalable
- Full SQL support

**Disadvantages**:
- Additional infrastructure required

**Why Not Selected**: Required external infrastructure, violating single-binary distribution goal.

### Option 4: File-based with custom format

**Description**: Store memories as individual files in a custom format.

**Advantages**:
- Simple implementation
- Human-readable

**Disadvantages**:
- No ACID guarantees
- Custom tooling needed

**Why Not Selected**: Lacked transactional guarantees and required custom tooling.

## Decision

We decided to use git notes as the primary persistence layer:

- Notes attached to commits in `refs/notes/mem/{namespace}`
- YAML front matter for metadata
- Markdown body for content
- Cat-sort-uniq merge strategy

## Consequences

### Positive

- Built-in version history
- Free remote sync via git push/pull
- Works with existing git workflows
- No additional infrastructure

### Negative

- Git dependency
- Performance at scale (10K+ memories)
- Complex merge conflicts
- Not suitable for multi-user concurrent writes

### Neutral

- Learning curve for git notes concepts
- Requires git repository context

## Decision Outcome

Git notes provide free versioning and sync while staying local-first. The scaling limitations are acceptable for the target use case (individual developers, small teams).

## Supersession Note

This decision was superseded because the `force=true` flag in `notes.add_to_head()` caused **every new memory to overwrite the previous one** - a critical data integrity bug. See [ADR-0047](adr_0047.md) for the replacement decision.

## More Information

- **Date:** 2025-12-28
- **Source:** SPEC-2025-12-28: Subcog Rust Rewrite
- **Related ADRs:** [ADR-0047](adr_0047.md) (supersedes this ADR)

## Audit

### 2026-01-15

**Status:** Superseded

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| This ADR has been superseded by ADR-0047 | - | - | superseded |

**Summary:** ADR migrated to structured-madr format. Git notes persistence was replaced by SQLite.

**Action Required:** None - this ADR is historical documentation only.
