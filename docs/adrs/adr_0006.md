---
title: "Git Notes as Primary Persistence"
description: "Original decision to use git notes for memory persistence, later superseded by ADR-0047 due to critical data overwrite bug."
type: adr
category: storage
tags:
  - git-notes
  - persistence
  - storage
  - superseded
  - version-control
status: deprecated
created: 2025-12-28
updated: 2026-01-04
author: Claude (Architect)
project: subcog
related:
  - docs/adrs/adr_0047.md
technologies:
  - git
  - git-notes
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0006: Git Notes as Primary Persistence

## Status

**Superseded** by [ADR-0047](adr_0047.md)

> **Note**: This ADR was superseded on 2026-01-03 by ADR-0047 (Remove Git-Notes Storage Layer) due to a critical bug where git notes would overwrite previous memories.

## Context

Memory storage needs:

- Durability
- Version history
- Remote synchronization
- Merge capability

## Options Considered

### Option 1: SQLite with custom sync

**Pros:**
- ACID transactions
- Fast queries
- Single file

**Cons:**
- Custom sync implementation needed
- No built-in version history

### Option 2: Git notes

**Pros:**
- Built-in version history
- Free remote sync via git push/pull

**Cons:**
- Performance at scale
- Complex merge conflicts

### Option 3: PostgreSQL

**Pros:**
- Scalable
- Full SQL support

**Cons:**
- Additional infrastructure required

### Option 4: File-based with custom format

**Pros:**
- Simple implementation
- Human-readable

**Cons:**
- No ACID guarantees
- Custom tooling needed

## Decision

We decided to use git notes as the primary persistence layer:

- Notes attached to commits in `refs/notes/mem/{namespace}`
- YAML front matter for metadata
- Markdown body for content
- Cat-sort-uniq merge strategy

## Consequences

### Positive

- Built-in version history
- Free remote sync via git push/pull
- Works with existing git workflows
- No additional infrastructure

### Negative

- Git dependency
- Performance at scale (10K+ memories)
- Complex merge conflicts
- Not suitable for multi-user concurrent writes

## Decision Outcome

Git notes provide free versioning and sync while staying local-first. The scaling limitations are acceptable for the target use case (individual developers, small teams).

## Supersession Note

This decision was superseded because the `force=true` flag in `notes.add_to_head()` caused **every new memory to overwrite the previous one** - a critical data integrity bug. See [ADR-0047](adr_0047.md) for the replacement decision.

## More Information

- **Date:** 2025-12-28
- **Source:** SPEC-2025-12-28: Subcog Rust Rewrite
- **Related ADRs:** [ADR-0047](adr_0047.md) (supersedes this ADR)
