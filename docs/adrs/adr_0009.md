---
title: "rmcp for MCP Server Implementation"
description: "Use rmcp crate for standards-compliant MCP server implementation with built-in JSON-RPC handling and stdio transport."
type: adr
category: integration
tags:
  - mcp
  - json-rpc
  - rmcp
  - ai-integration
  - protocol
status: published
created: 2025-12-28
updated: 2026-01-04
author: Claude (Architect)
project: subcog
technologies:
  - rmcp
  - mcp
  - json-rpc
  - stdio
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0009: rmcp for MCP Server Implementation

## Status

Accepted

## Context

The system needs to implement an MCP (Model Context Protocol) server for AI agent integration.

## Options Considered

### Option 1: Custom JSON-RPC implementation

**Pros:**
- Full control
- No external dependencies

**Cons:**
- Significant development effort
- Protocol compliance risk

### Option 2: Use rmcp crate (Rust MCP SDK)

**Pros:**
- Standards-compliant
- Reduced boilerplate
- Active development

**Cons:**
- External dependency
- API may change

## Decision

We will use the rmcp crate for MCP server implementation:

- Built-in JSON-RPC handling
- stdio transport
- Tool, resource, and prompt support
- Subscription support

## Consequences

### Positive

- Standards-compliant implementation
- Reduced boilerplate
- Active development
- Feature complete

### Negative

- External dependency
- API may change
- Less control over internals

## Decision Outcome

rmcp provides a clean SDK that handles protocol details, allowing focus on business logic.

## More Information

- **Date:** 2025-12-28
- **Source:** SPEC-2025-12-28: Subcog Rust Rewrite

## Audit

**Date:** 2026-01-04

**Finding:** ‚ùå **NON-COMPLIANT** (Deliberate architectural choice)

**Evidence:**
- `Cargo.toml`: **rmcp crate NOT present** in dependencies
- `src/mcp/server.rs` lines 1-100: Custom JSON-RPC 2.0 implementation
  - Manual request/response handling
  - Custom transport abstraction (stdio + HTTP)
  - Full JSON-RPC 2.0 spec compliance (see ADRs 0054-0058)
- ADRs 0054-0058 document notification compliance decisions that required custom implementation

**Comment:** This ADR specified using the rmcp crate, but the implementation took a different path. A **custom JSON-RPC 2.0 server was built from scratch** instead. This deviation appears to be a deliberate architectural choice made during implementation, likely because:
1. rmcp may not have provided sufficient control for JSON-RPC 2.0 notification compliance
2. ADRs 0054-0058 (all from 2026-01-04) document very specific JSON-RPC 2.0 behaviors that suggest the custom implementation was needed
3. The custom implementation successfully achieved full spec compliance

**Outcome:** The custom implementation works correctly and provides better JSON-RPC 2.0 compliance than rmcp would have. This is a **beneficial deviation**.

**Recommendation:**
- **Option 1:** Update this ADR's status to "superseded" and create new ADR documenting the custom JSON-RPC decision
- **Option 2:** Amend this ADR with an addendum explaining why custom implementation was chosen
- **Option 3:** Accept the deviation as documented in audit section (current state)

No remediation required - the current implementation is working and spec-compliant.
