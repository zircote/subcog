---
title: "Namespace Weighting Over Query Rewriting"
description: "Apply post-retrieval weight multipliers to namespaces based on detected intent type rather than rewriting search queries."
type: adr
category: search
tags:
  - namespace-weighting
  - ranking
  - search-relevance
  - intent-detection
status: published
created: 2025-12-30
updated: 2026-01-15
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0012: Namespace Weighting Over Query Rewriting

## Status

Accepted

## Context

To improve recall relevance based on detected intent type, we could either:

1. Rewrite the search query to include namespace-specific terms
2. Apply post-retrieval weight multipliers to specific namespaces

The goal is to surface more relevant memories when the system detects specific user intents (e.g., troubleshooting, how-to questions, location queries).

## Decision Drivers

### Primary Decision Drivers

1. **Separation of Concerns**: Keeping retrieval and ranking as separate phases makes the system easier to understand, test, and debug.

2. **Query Semantics Preservation**: Rewriting queries changes their meaning in unpredictable ways, while post-retrieval weighting preserves the original search intent.

3. **Tunability**: Weight multipliers can be adjusted without changing the underlying search implementation.

### Secondary Decision Drivers

1. **Compatibility**: Works with existing RecallService search methods without modification.

2. **Transparency**: Easier to explain why certain memories ranked higher (explicit weight multipliers vs. hidden query modifications).

## Considered Options

### Option 1: Query rewriting

**Description**: Modify the search query to include namespace-specific terms (e.g., "auth patterns" instead of "auth").

**Advantages**:
- Single retrieval pass
- Potentially more precise targeting

**Disadvantages**:
- Changes semantics of search, harder to predict results
- Complex query construction logic
- May miss relevant memories in other namespaces

### Option 2: Filtered search per namespace

**Description**: Run separate searches for each weighted namespace, then merge results.

**Advantages**:
- Precise namespace targeting
- Clear separation of results

**Disadvantages**:
- Multiple queries = higher latency
- Complex result merging
- Resource intensive

### Option 3: Post-retrieval namespace weighting (Chosen)

**Description**: Retrieve broadly, then apply weight multipliers based on detected intent and memory namespace.

**Advantages**:
- Clean separation of concerns (retrieval vs ranking)
- Easier to understand and debug
- Works with existing RecallService search methods
- Weights can be tuned without changing queries

**Disadvantages**:
- May retrieve irrelevant memories before weighting
- Requires fetching more memories than needed (2x limit)

## Decision

We will use **namespace weight multipliers** applied after retrieval:

- HowTo: Patterns 1.5x, Learnings 1.3x
- Troubleshoot: Blockers 1.5x, Learnings 1.3x
- Location/Explanation: Decisions 1.5x, Context 1.3x

The system retrieves 2x the requested limit, applies weights, then returns the top results.

## Consequences

### Positive

- Clean separation of concerns (retrieval vs ranking)
- Easier to understand and debug
- Works with existing RecallService search methods
- Weights can be tuned without changing queries

### Negative

- May retrieve irrelevant memories before weighting
- Requires fetching more memories than needed (2x limit)
- Additional processing step adds minor latency

### Neutral

- Weights are static per intent type (no learning)
- Weight values may need tuning based on user feedback

## More Information

- **Date:** 2025-12-30
- **Source:** SPEC-2025-12-30-001: Proactive Memory Surfacing

## Audit

### 2026-01-15

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| Namespace weights applied during post-retrieval rerank | `src/hooks/search_context.rs` | L381-L406 | compliant |

**Summary:** Namespace weights are applied after retrieval rather than query rewriting.

**Action Required:** None
