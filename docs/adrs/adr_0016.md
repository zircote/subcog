---
title: "Confidence Threshold for Injection"
description: "Configurable confidence threshold (default 0.5) with graduated memory injection response to reduce false positives while maintaining useful recall."
type: adr
category: performance
tags:
  - confidence-threshold
  - memory-injection
  - configuration
  - search-intent
status: accepted
created: 2025-12-30
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0016: Confidence Threshold for Injection

## Status

Accepted

## Context

Not all detected intents should trigger memory injection. Very low confidence detections may inject irrelevant memories.

## Decision Drivers

### Primary Decision Drivers

1. **Noise Reduction**: Low-confidence detections often add irrelevant memories that distract from the task at hand.

2. **User Experience**: Users expect memory injection to be helpful, not overwhelming or off-topic.

3. **Configurability**: Different environments and use cases may require different sensitivity levels.

### Secondary Decision Drivers

1. **Graduated Response**: Higher confidence should unlock more aggressive memory injection.

2. **Logging Transparency**: Even low-confidence detections should be logged for debugging and tuning.

## Considered Options

### Option 1: Always Inject on Any Detection

**Description**: Inject memories whenever any intent is detected, regardless of confidence level.

**Advantages**:
- Simple implementation
- Maximum recall

**Disadvantages**:
- Low-confidence detections add noise and reduce signal-to-noise ratio
- Poor user experience with irrelevant injections

**Why Not Selected**: Creates too much noise from low-confidence detections.

### Option 2: User-Configurable Per Session

**Description**: Allow users to configure the threshold dynamically during each session.

**Advantages**:
- Maximum flexibility for users

**Disadvantages**:
- Too complex for MVP
- Requires session state management

**Why Not Selected**: Deferred for future enhancement due to implementation complexity.

### Option 3: Configurable Threshold with Graduated Response (Selected)

**Description**: Use a configurable threshold (default 0.5) with graduated response levels.

**Advantages**:
- Balances noise reduction with useful recall
- Configurable per environment
- Graduated response based on confidence

**Disadvantages**:
- Default threshold may not be optimal for all users

**Why Selected**: Best balance of simplicity, configurability, and user experience.

## Decision

We will use a **configurable confidence threshold** (default 0.5):

- Confidence < 0.5: No memory injection, signal still logged
- Confidence >= 0.5: Inject memories, include reminder
- Confidence >= 0.8: Inject more memories (max_count)

## Consequences

### Positive

- Reduces false positive injections
- Threshold can be tuned per environment
- Graduated response based on confidence

### Negative

- May miss valid intents at threshold boundary
- Default may not be optimal for all users

### Neutral

- Threshold exposed in configuration
- Logging provides visibility into filtered detections

## More Information

- **Date:** 2025-12-30
- **Source:** SPEC-2025-12-30-001: Proactive Memory Surfacing

## Audit

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| Confidence threshold checked before context assembly | `src/hooks/search_context.rs` | L349-L353 | compliant |

**Summary:** Injection is gated by a configurable confidence threshold (default 0.5).

**Action Required:** None
