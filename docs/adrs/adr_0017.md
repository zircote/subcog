---
title: "Short-Circuit Evaluation Order"
description: "Evaluate deduplication checks in order Exact Match → Semantic Similarity → Recent Capture with short-circuit on first match for optimal performance."
type: adr
category: performance
tags:
  - deduplication
  - short-circuit
  - evaluation-order
  - optimization
status: published
created: 2026-01-01
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0017: Short-Circuit Evaluation Order

## Status

Accepted

## Context

The deduplication service needs to perform three checks: exact match, semantic similarity, and recent capture. These checks have different performance characteristics and accuracy levels. We need to determine the order of evaluation.

## Decision

We will evaluate in order: **Exact Match → Semantic Similarity → Recent Capture**, with short-circuit on first match.

## Consequences

### Positive

- Exact match is fastest (<10ms) and most accurate - handles common case efficiently
- Semantic check runs only when exact match fails (reduces embedding cost)
- Recent capture is last since it's a fallback for rapid duplicates

### Negative

- Recent capture may catch something semantic would have caught at higher confidence
- Order is fixed (not configurable)

### Neutral

- All three checks are independent and could theoretically run in parallel

## More Information

- **Date:** 2026-01-01
- **Source:** SPEC-2026-01-01-001: Pre-Compact Deduplication

## Audit

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| Exact -> semantic -> recent order with early return | `src/services/deduplication/service.rs` | L271-L322 | compliant |

**Summary:** Deduplication checks run in the specified short-circuit order.

**Action Required:** None
