---
title: "Content Hash Storage as Tags"
description: "Store SHA256 content hashes as tags (hash:sha256:<16-char-prefix>) for fast exact-match lookup without schema migration."
type: adr
category: storage
tags:
  - content-hash
  - sha256
  - deduplication
  - tags
  - sqlite
status: published
created: 2026-01-01
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0018: Content Hash Storage as Tags

## Status

Accepted

## Context

To enable fast exact-match lookup, we need to store a content hash with each memory. Options include: new schema column, metadata field, or tags.

## Decision

We will store SHA256 hash as a tag with format `hash:sha256:<16-char-prefix>`.

## Consequences

### Positive

- No schema migration required
- Works with existing tag search infrastructure
- SQLite FTS5 index already optimized for tag queries
- Tag prefix allows for multiple hash algorithms in future

### Negative

- Tag storage slightly less efficient than dedicated column
- Truncated to 16 chars (collision unlikely but possible)
- Pollutes tag namespace

## Options Considered

### Option 1: New schema column

**Pros:**
- More efficient lookup

**Cons:**
- Would require migration

### Option 2: Metadata JSON field

**Pros:**
- Flexible

**Cons:**
- No index support

### Option 3: Separate hash table

**Cons:**
- More complex, additional storage layer

## More Information

- **Date:** 2026-01-01
- **Source:** SPEC-2026-01-01-001: Pre-Compact Deduplication

## Audit

### 2026-01-04

**Status:** Partial

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| Hash tag format `hash:sha256:<prefix>` implemented | `src/services/deduplication/hasher.rs` | L61-L91 | compliant |
| Capture stores tags only from request without hash tag | `src/services/capture.rs` | L223-L234 | gap |

**Summary:** Hash tag format exists, but capture does not add hash tags to stored memories.

**Action Required:** Append the hash tag to memory.tags during capture.

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| Capture appends `hash:sha256:<prefix>` tag during memory creation | `src/services/capture.rs` | L235-L238 | compliant |

**Summary:** Capture now injects hash tags into stored memory tags as required.

**Action Required:** None
