---
title: "In-Memory LRU Cache for Recent Captures"
description: "Use in-memory LRU cache with TTL eviction for tracking recent captures, providing sub-millisecond lookups without external dependencies."
type: adr
category: caching
tags:
  - lru-cache
  - in-memory
  - deduplication
  - performance
  - ttl
status: published
created: 2026-01-01
updated: 2026-01-04
author: Claude (Architect)
project: subcog
technologies:
  - rust
  - lru
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0020: In-Memory LRU Cache for Recent Captures

## Status

Accepted

## Context

We need to track recently captured content to prevent rapid duplicate captures within a 5-minute window. Options include: in-memory cache, SQLite query, Redis.

## Decision

We will use an in-memory LRU cache with TTL eviction.

## Consequences

### Positive

- Fastest option (<1ms lookup)
- No external dependencies
- Bounded memory usage (1000 entries max)
- Simple implementation with `lru` crate

### Negative

- State lost on process restart (acceptable - window is only 5 minutes)
- Not shared across multiple subcog instances
- TTL handling requires custom logic

## Options Considered

### Option 1: SQLite query

**Cons:**
- Would add ~10-30ms latency per check

### Option 2: Redis

**Cons:**
- Adds operational complexity, overkill for single-instance use

### Option 3: Both with fallback

**Cons:**
- Complexity not justified for this use case

## More Information

- **Date:** 2026-01-01
- **Source:** SPEC-2026-01-01-001: Pre-Compact Deduplication

## Audit

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| LRU cache with TTL for recent captures | `src/services/deduplication/recent.rs` | L1-L101 | compliant |

**Summary:** Recent capture deduplication uses an LRU cache with TTL.

**Action Required:** None
