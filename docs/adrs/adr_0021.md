---
title: "Fail-Open on Deduplication Errors"
description: "Prioritize data capture over duplicate prevention by failing open when deduplication checks encounter errors."
type: adr
category: resilience
tags:
  - fail-open
  - error-handling
  - deduplication
  - graceful-degradation
status: published
created: 2026-01-01
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0021: Fail-Open on Deduplication Errors

## Status

Accepted

## Context

What should happen if a deduplication check fails? Options: fail closed (block capture), fail open (allow capture), or skip with warning.

## Decision Drivers

### Primary Decision Drivers

1. **Data Preservation Priority**: Losing unique content is worse than storing a duplicate. Duplicates can be cleaned up later; lost data cannot be recovered.

2. **User Experience Continuity**: Users should not be blocked from capturing important insights due to transient service failures.

3. **Alignment with Existing Philosophy**: The hook error handling already follows fail-open semantics for consistency.

### Secondary Decision Drivers

1. **Post-Hoc Cleanup**: The consolidation service can identify and clean up duplicates that slip through during failures.

2. **Observability**: Failures should be logged and metriced for operational awareness without blocking operations.

## Decision

We will fail open - if deduplication checks fail, proceed with capture and log a warning.

## Consequences

### Positive

- Prioritizes data capture over duplicate prevention
- Aligns with existing hook error handling philosophy
- Temporary failures don't block important captures
- Consolidation service can clean up duplicates later

### Negative

- May capture duplicates during service degradation
- Errors might go unnoticed if only logged at warn level

### Neutral

- Metrics will show elevated capture counts during failures

## Considered Options

### Option 1: Fail Closed (Block Capture)

**Description**: If deduplication check fails, reject the capture request entirely.

**Advantages**: Guarantees no duplicates slip through during errors.

**Disadvantages**: Users lose data during transient failures; poor user experience.

### Option 2: Fail Open (Allow Capture) - Selected

**Description**: If deduplication check fails, proceed with capture and log a warning.

**Advantages**: Prioritizes data preservation; consistent with existing error handling philosophy.

**Disadvantages**: May allow duplicates during degraded service periods.

### Option 3: Skip with Warning and Retry Queue

**Description**: Queue failed captures for retry after service recovery.

**Advantages**: Eventually consistent deduplication without data loss.

**Disadvantages**: Complex implementation; adds state management; delayed capture confirmation.

## More Information

- **Date:** 2026-01-01
- **Source:** SPEC-2026-01-01-001: Pre-Compact Deduplication

## Audit

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| Exact/semantic errors log warnings and continue | `src/services/deduplication/service.rs` | L171-L218 | compliant |

**Summary:** Deduplication errors are logged and processing continues (fail-open).

**Action Required:** None
