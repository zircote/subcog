---
title: "RecallService for Deduplication Lookups"
description: "Use RecallService.search() for deduplication lookups to maintain consistency with existing search patterns and abstractions."
type: adr
category: architecture
tags:
  - recall-service
  - deduplication
  - search
  - abstraction
status: accepted
created: 2026-01-01
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0023: RecallService for Deduplication Lookups

## Status

Accepted

## Context

We need to query existing memories to check for duplicates. Options: direct index query, direct vector query, or use RecallService.

## Decision Drivers

### Primary Decision Drivers

1. **Abstraction Consistency**: RecallService is the established abstraction for all memory queries in Subcog. Bypassing it for deduplication would create inconsistent patterns.

2. **Hybrid Search Support**: RecallService automatically handles hybrid search modes (text + vector), providing robust fallback behavior.

3. **Future Optimization Benefits**: Any performance optimizations to RecallService automatically benefit deduplication lookups.

### Secondary Decision Drivers

1. **Single Source of Truth**: Centralizing search logic in RecallService reduces code duplication and maintenance burden.

2. **Filter Support**: RecallService already supports namespace and tag filtering needed for deduplication queries.

## Decision

We will use `RecallService.search()` with appropriate filters for deduplication lookups.

## Consequences

### Positive

- Consistent with existing search patterns
- Automatic handling of hybrid search modes
- Benefits from any future RecallService optimizations
- Single source of truth for search logic

### Negative

- Slightly more overhead than direct backend queries
- RecallService may do more work than strictly needed

### Neutral

- Deduplication query patterns documented alongside other RecallService usage

## Considered Options

### Option 1: Direct IndexBackend Query

**Description**: Query the SQLite FTS5 index directly for exact-match lookups.

**Advantages**: Fastest possible lookup, minimal overhead.

**Disadvantages**: Bypasses abstractions, duplicates query logic, no hybrid fallback.

### Option 2: Direct VectorBackend Query

**Description**: Query the vector index directly for semantic similarity checks.

**Advantages**: Direct access to similarity scores.

**Disadvantages**: Misses text-based fallback, inconsistent with other queries.

### Option 3: New DeduplicationBackend

**Description**: Create a dedicated backend abstraction for deduplication queries.

**Advantages**: Optimized specifically for deduplication use case.

**Disadvantages**: Overkill complexity, duplicates existing RecallService functionality.

### Option 4: RecallService.search() (Selected)

**Description**: Use the existing RecallService abstraction with appropriate filters.

**Advantages**: Consistent patterns, hybrid search support, benefits from future optimizations.

**Disadvantages**: Slightly more overhead than direct queries.

## More Information

- **Date:** 2026-01-01
- **Source:** SPEC-2026-01-01-001: Pre-Compact Deduplication

## Audit

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| ExactMatchChecker queries RecallService with tag filters | `src/services/deduplication/exact_match.rs` | L39-L112 | compliant |

**Summary:** Deduplication exact-match uses RecallService queries.

**Action Required:** None
