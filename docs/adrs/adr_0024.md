---
title: "Hook Output Format for Skip Reporting"
description: "Include detailed skip information in hook additionalContext with reason, matched ID, and similarity score for transparency."
type: adr
category: integration
tags:
  - hook-output
  - deduplication
  - transparency
  - debugging
  - urn
status: accepted
created: 2026-01-01
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - operators
confidence: high
completeness: complete
---

# ADR-0024: Hook Output Format for Skip Reporting

## Status

Accepted

## Context

How should skipped duplicates be reported in the hook output? Options: silent skip, count only, or detailed listing.

## Decision Drivers

### Primary Decision Drivers

1. **Debugging Transparency**: Users need to understand why content was skipped to verify deduplication is working correctly and tune thresholds if needed.

2. **Threshold Tuning**: Similarity scores in the output help users decide whether to adjust per-namespace thresholds.

3. **Audit Trail**: Detailed skip information provides an audit trail for investigating deduplication behavior.

### Secondary Decision Drivers

1. **Memory Reference Format**: Using full URN format (`subcog://{domain}/{namespace}/{id}`) ensures skip reports are actionable and linkable.

2. **Reason Categorization**: Distinguishing between exact match, semantic similarity, and recent capture helps users understand which deduplication layer triggered.

## Decision

We will include detailed skip information in `additionalContext` with reason, matched ID, and similarity score.

## Consequences

### Positive

- Full transparency for debugging
- Users can verify deduplication is working
- Similarity scores help tune thresholds

### Negative

- Longer output in hook response
- May be verbose during high-dedup scenarios

### Neutral

- Output format is consistent with other hook reporting patterns

## Considered Options

### Option 1: Silent Skip

**Description**: Skip duplicates without any indication in the output.

**Advantages**: Cleanest output, minimal noise.

**Disadvantages**: No transparency, impossible to debug or verify behavior.

### Option 2: Count Only

**Description**: Report only the count of skipped duplicates (e.g., "Skipped 3 duplicates").

**Advantages**: Concise, indicates deduplication is working.

**Disadvantages**: No details for debugging, cannot tune thresholds.

### Option 3: Detailed Listing (Selected)

**Description**: Report reason, matched URN, and similarity score for each skip.

**Advantages**: Full transparency, enables threshold tuning, provides audit trail.

**Disadvantages**: Verbose during high-deduplication scenarios.

## Output Format

```
Skipped 3 duplicates:
- Exact match: "Use PostgreSQL for..." (matches subcog://global/decisions/abc123)
- Semantic 94%: "We chose Postgres..." (similar to subcog://global/decisions/abc123)
- Recent capture: "PostgreSQL decision..." (captured 2 min ago, subcog://global/decisions/def456)
```

**Note**: All memory references use full URN format: `subcog://{domain}/{namespace}/{id}`

## More Information

- **Date:** 2026-01-01
- **Source:** SPEC-2026-01-01-001: Pre-Compact Deduplication

## Audit

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| Skip reporting includes reason, matched URN, and score | `src/hooks/pre_compact/formatter.rs` | L19-L103 | compliant |

**Summary:** Hook output includes skip reasons, URNs, and similarity scores.

**Action Required:** None
