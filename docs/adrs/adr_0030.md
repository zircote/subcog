---
title: "User Frontmatter Preservation"
description: "Merge LLM enrichment with user-provided frontmatter, filling gaps while preserving user values to respect user intent."
type: adr
category: architecture
tags:
  - merge
  - frontmatter
  - user-values
  - enrichment
status: published
created: 2026-01-01
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0030: User Frontmatter Preservation

## Status

Accepted

## Context

When user provides partial frontmatter, how should enrichment behave?

- Overwrite all with LLM output
- Merge (LLM fills gaps, user values preserved)
- Skip enrichment entirely if any frontmatter present

## Decision

We will **merge** - LLM fills gaps, but user-provided values are never overwritten.

## Consequences

### Positive

- User intent is respected
- Can provide partial metadata and let LLM complete
- No surprises (user sees their values preserved)

### Negative

- More complex merge logic
- User can't "reset" to LLM-suggested values without removing their values

## Implementation

```rust
fn merge_enrichment(user: &PartialMetadata, llm: &EnrichmentResult) -> EnrichmentResult {
    EnrichmentResult {
        description: user.description.clone().unwrap_or_else(|| llm.description.clone()),
        tags: if user.tags.is_empty() { llm.tags.clone() } else { user.tags.clone() },
        variables: merge_variables(&user.variables, &llm.variables),
    }
}
```

## More Information

- **Date:** 2026-01-01
- **Source:** SPEC-2026-01-01-002: Prompt Variable Context-Aware Extraction
