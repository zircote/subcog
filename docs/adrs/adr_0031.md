---
title: "Graceful Fallback Strategy"
description: "Fall back to basic variable extraction when LLM enrichment fails, ensuring save never fails due to enrichment issues."
type: adr
category: resilience
tags:
  - graceful-fallback
  - error-handling
  - llm-enrichment
  - degradation
status: published
created: 2026-01-01
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0031: Graceful Fallback Strategy

## Status

Accepted

## Context

What happens when LLM enrichment fails (unavailable, timeout, invalid response)?

## Decision

We will use **graceful fallback** to basic variable extraction (name + required=true).

## Consequences

### Positive

- Save never fails due to enrichment
- User can still work offline
- Consistent with subcog's degradation philosophy

### Negative

- Silent degradation may surprise users
- Metadata quality inconsistent when LLM flaky

## Implementation

```rust
// Log the fallback reason
tracing::warn!("Enrichment failed, using fallback: {}", error);

// Return basic metadata
EnrichmentResult::basic_from_variables(variables)
```

## User Feedback

- CLI shows: "Note: LLM enrichment unavailable, using basic metadata"
- MCP response includes: `"enrichment_status": "fallback"`

## More Information

- **Date:** 2026-01-01
- **Source:** SPEC-2026-01-01-002: Prompt Variable Context-Aware Extraction

## Audit

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| enrich_with_fallback returns basic metadata on failure | `src/services/prompt_enrichment.rs` | L359-L376 | compliant |

**Summary:** LLM enrichment failures fall back to basic variable extraction.

**Action Required:** None
