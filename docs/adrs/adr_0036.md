---
title: "Graceful Degradation Strategy"
description: "Use graceful degradation with clear fallback hierarchy to ensure system remains functional under partial component failure."
type: adr
category: resilience
tags:
  - graceful-degradation
  - fallback
  - component-failure
  - availability
status: accepted
created: 2026-01-02
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
  - operators
confidence: high
completeness: complete
---

# ADR-0036: Graceful Degradation Strategy

## Status

Accepted

## Context

The system has multiple components that may fail independently:
- Embedding service (model load failure)
- Vector backend (index corruption)
- Index backend (SQLite issues)
- Network (for remote backends)

Need to ensure system remains useful even when components fail.

## Decision Drivers

### Primary Decision Drivers

1. **Availability**: System should remain functional even with partial component failure
2. **Data Integrity**: Persistence layer must always succeed; data loss is unacceptable
3. **User Experience**: Users should receive the best available results, not errors

### Secondary Decision Drivers

1. **Transparency**: Users should be informed when operating in degraded mode
2. **Observability**: Component health should be visible via status commands
3. **Recoverability**: Failed components should be repairable without data loss

## Considered Options

### Option 1: Fail Fast

**Description**: Any component failure stops the operation entirely.

**Advantages**:
- Clear error handling
- No ambiguity about results

**Disadvantages**:
- Poor availability
- Single component failure blocks everything
- Frustrating user experience

### Option 2: Graceful Degradation (Selected)

**Description**: Fall back to available components with clear fallback hierarchy.

**Advantages**:
- System remains functional
- Users get best available results
- Data never lost

**Disadvantages**:
- May return incomplete results
- Warnings may be ignored
- Degraded performance may be confusing

### Option 3: Queue and Retry

**Description**: Queue failed operations for later retry.

**Advantages**:
- Eventually consistent
- No lost operations

**Disadvantages**:
- Complex queue management
- Delayed results
- Hard to debug

## Decision

We will use **graceful degradation** with clear fallback hierarchy.

Degradation matrix:

| Embedder | Vector | Index | Behavior |
|----------|--------|-------|----------|
| OK | OK | OK | Full hybrid search |
| OK | OK | FAIL | Vector-only + warning |
| OK | FAIL | OK | Text-only (BM25) + warning |
| FAIL | FAIL | OK | Text-only (BM25) + warning |
| FAIL | FAIL | FAIL | Error: no search available |

For capture:
```
1. Embedding fails -> Capture to persistence without embedding + warning
2. Index fails -> Continue, log warning
3. Vector fails -> Continue, log warning
4. Persistence fails -> Error (authoritative store must succeed)
```

## Consequences

### Positive

- System remains functional under partial failure
- Users get best available results
- Data never lost (persistence is authoritative)

### Negative

- May return incomplete results without user knowing
- Warnings may be ignored
- Degraded performance may be confusing

### Neutral

- Requires clear messaging about degraded mode
- `subcog status` shows component health
- Structured logging needed for monitoring

## Decision Outcome

Graceful degradation ensures maximum availability while maintaining data integrity.

Mitigations:
- Clear messaging about degraded mode
- `subcog status` shows component health
- Structured logging for monitoring

## More Information

- **Date:** 2026-01-02
- **Source:** SPEC-2026-01-02: Memory System Critical Fixes

## Audit

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| RecallService documents fallback behavior when vector is unavailable | `src/services/recall.rs` | L33-L38 | compliant |
| CaptureService logs warnings and continues on secondary failures | `src/services/capture.rs` | L24-L28 | compliant |

**Summary:** Search and capture paths implement graceful degradation with warnings.

**Action Required:** None
