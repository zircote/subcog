---
title: "Backward Compatibility with Existing Memories"
description: "Support backward compatible memories with optional embeddings and provide manual migration tool for gradual upgrade path."
type: adr
category: migration
tags:
  - backward-compatibility
  - migration
  - embeddings
  - upgrade-path
status: published
created: 2026-01-02
updated: 2026-01-04
author: Claude (Architect)
project: subcog
related:
  - adr_0050.md
audience:
  - developers
  - architects
  - operators
confidence: high
completeness: complete
---

# ADR-0039: Backward Compatibility with Existing Memories

## Status

Accepted

## Context

Existing Subcog installations have memories in Git Notes without embeddings. Need to ensure:
1. Old memories remain accessible
2. New memories get embeddings
3. Migration path exists

Options considered:
1. **Breaking change** - Require all memories to have embeddings
2. **Backward compatible** - Support memories with/without embeddings
3. **Auto-migrate** - Automatically add embeddings on access
4. **Manual migrate** - Provide migration tool

## Decision

We will use **backward compatible** with **manual migration** tool.

```rust
// Memory struct supports optional embedding
pub struct Memory {
    pub embedding: Option<Vec<f32>>,  // None for old memories
    // ...
}

// Search handles missing embeddings
fn search(&self, query: &str) -> Vec<SearchResult> {
    let text_results = self.text_search(query);  // Always works
    let vector_results = self.vector_search(query);  // Only for embedded
    self.fuse(text_results, vector_results)
}
```

## Consequences

### Positive

- Existing users not disrupted
- Gradual migration at user's pace
- Old memories still searchable via text

### Negative

- Old memories won't appear in vector search
- Need to maintain backward compatibility code

## Options Considered

| Approach | User Effort | Risk | Complexity |
|----------|-------------|------|------------|
| Breaking | High | High | Low |
| Backward compat | None | Low | Medium |
| Auto-migrate | None | Medium | High |
| Manual migrate | Low | Low | Medium |

## Decision Outcome

Backward compatibility ensures smooth upgrade path. Manual migration gives users control.

Mitigations:
- `subcog migrate embeddings` command
- Clear documentation
- Status command shows migration status

## More Information

- **Date:** 2026-01-02
- **Source:** SPEC-2026-01-02: Memory System Critical Fixes
- **Note:** This ADR predates ADR-0050 (Fresh Start). The fresh start decision means no migration is needed.
