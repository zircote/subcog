---
title: "SQLite for User-Scope Persistence"
description: "Use SQLite for user-scope persistence outside git repositories, leveraging existing rusqlite dependency for ACID-compliant storage."
type: adr
category: storage
tags:
  - sqlite
  - persistence
  - user-scope
  - acid
status: published
created: 2026-01-02
updated: 2026-01-04
author: Claude (Architect)
project: subcog
technologies:
  - sqlite
  - rusqlite
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0040: SQLite for User-Scope Persistence

## Status

Accepted

## Context

When operating outside a git repository, we need an alternative persistence layer for user-scoped memories.

Options considered:
1. SQLite database
2. JSON files in user directory
3. TOML/YAML files
4. No persistence (memory only)

## Decision

We will use **SQLite** for user-scope persistence.

## Consequences

### Positive

- No new dependencies (`rusqlite` already used for index layer)
- Familiar patterns from index implementation
- Atomic operations prevent data loss
- ACID transactions prevent data corruption on crash
- Single file for easy backup (`memories.db`)
- Query support for filtering by namespace, searching content

### Negative

- Not human-readable like JSON/YAML
- Requires schema migrations for future changes

## Alternatives Considered

- **JSON files**: No ACID, harder to query, file-per-memory creates clutter
- **TOML/YAML**: Same issues as JSON
- **Memory only**: Data lost on restart, unacceptable for memories

## Decision Outcome

SQLite provides the best balance of reliability, performance, and development efficiency given it's already a dependency.

## More Information

- **Date:** 2026-01-02
- **Source:** SPEC-2026-01-02: User-Scope Storage Fallback
