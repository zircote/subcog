---
title: "Conditional Git Notes in CaptureService"
description: "Add use_git_notes flag to CaptureService for conditional git notes storage, enabling user-scope operation."
type: adr
category: architecture
tags:
  - capture-service
  - git-notes
  - conditional
  - user-scope
status: published
created: 2026-01-02
updated: 2026-01-04
author: Claude (Architect)
project: subcog
related:
  - adr_0047.md
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0041: Conditional Git Notes in CaptureService

## Status

Accepted

## Context

CaptureService currently always attempts to store to git notes. For user-scope, git notes are unavailable.

Options considered:
1. Add `use_git_notes: bool` flag to CaptureService
2. Create separate `UserCaptureService` class
3. Make persistence layer fully pluggable

## Decision

We will add a `use_git_notes: bool` flag to CaptureService.

## Consequences

### Positive

- No new service class to maintain
- Existing tests continue to work
- Easy to understand behavior switch
- Minimal code change (single field addition)
- Clear semantics (flag name self-documents behavior)
- Reuses existing embedding, indexing, vector logic

### Negative

- Slight complexity increase in `capture()` method
- Must ensure flag is set correctly by factories

## Alternatives Considered

- **Separate UserCaptureService**: Code duplication, maintenance burden
- **Pluggable persistence**: Over-engineering for current requirements

## Decision Outcome

A simple flag provides the necessary flexibility without introducing architectural complexity.

## More Information

- **Date:** 2026-01-02
- **Source:** SPEC-2026-01-02: User-Scope Storage Fallback
- **Note:** This ADR predates ADR-0047 (Remove Git-Notes). Post ADR-0047, git notes are removed entirely.

## Audit

### 2026-01-04

**Status:** Violated

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| Capture storage layers do not reference git-notes | `src/services/capture.rs` | L16-L29 | violation |

**Summary:** CaptureService has no conditional git-notes flag or implementation.

**Action Required:** Implement use_git_notes flag or update ADR-0041.
