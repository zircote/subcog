---
title: "Factory Method Pattern for ServiceContainer"
description: "Use factory methods (for_repo, for_user, from_current_dir_or_user) on ServiceContainer for context-specific instantiation."
type: adr
category: architecture
tags:
  - factory-method
  - service-container
  - design-pattern
  - api-design
status: published
created: 2026-01-02
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0042: Factory Method Pattern for ServiceContainer

## Status

Accepted

## Context

Need to create ServiceContainer instances for different contexts (project vs user).

Options considered:
1. Factory methods on ServiceContainer
2. Builder pattern
3. Separate factory class
4. Configuration-based instantiation

## Decision

We will use **factory methods** on ServiceContainer: `for_repo()`, `for_user()`, `from_current_dir_or_user()`.

## Consequences

### Positive

- Consistent with existing API (`for_repo()` and `from_current_dir()` already exist)
- Easy to use and understand
- IDE autocomplete shows all options
- Self-documenting method names describe intent
- No new types (avoids adding builder/factory classes)

### Negative

- ServiceContainer impl block grows larger
- Each factory has its own initialization logic

## Alternatives Considered

- **Builder pattern**: Overkill for 3-4 factory methods
- **Separate factory class**: Adds indirection without benefit
- **Configuration-based**: Too implicit, harder to debug

## Decision Outcome

Factory methods provide a clean, discoverable API that follows established patterns in the codebase.

## More Information

- **Date:** 2026-01-02
- **Source:** SPEC-2026-01-02: User-Scope Storage Fallback
