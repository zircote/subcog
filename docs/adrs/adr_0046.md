---
title: "Fallback Order in from_current_dir_or_user()"
description: "Try project scope first via from_current_dir(), fall back to user scope on error for automatic scope selection."
type: adr
category: architecture
tags:
  - fallback
  - user-scope
  - project-scope
  - service-container
status: published
created: 2026-01-02
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0046: Fallback Order in `from_current_dir_or_user()`

## Status

Accepted

## Context

When automatically selecting scope, need to decide priority order.

Options considered:
1. Try project first, fall back to user
2. Try user first, fall back to project
3. Check `.git` explicitly, then decide
4. Always prefer user scope

## Decision

We will try **project scope first** via `from_current_dir()`, fall back to user scope on error.

## Consequences

### Positive

- No change in behavior for existing git repo users
- Clear fallback chain
- Easy to understand and debug
- Preserves existing behavior (project scope is default when available)
- Simple implementation (just catch the error)
- Git repo = project intent (if user is in git repo, they likely want project memories)
- Explicit fallback (only uses user scope when project is impossible)

### Negative

- Slight overhead trying project first (negligible)
- Error might be logged before fallback

## Alternatives Considered

- **User first**: Would break existing workflows in git repos
- **Explicit check**: Same result, more code
- **Always user**: Defeats purpose of project-scoped memories

## Decision Outcome

Project-first fallback maintains backward compatibility while enabling user-scope for non-git contexts.

## More Information

- **Date:** 2026-01-02
- **Source:** SPEC-2026-01-02: User-Scope Storage Fallback
