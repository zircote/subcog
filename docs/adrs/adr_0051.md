---
title: "Feature-Gate Org-Scope Implementation"
description: "Include org-scope in the design but feature-gate the implementation for future enablement."
type: adr
category: architecture
tags:
  - org-scope
  - feature-flags
  - postgresql
  - future-proofing
status: published
created: 2026-01-03
updated: 2026-01-04
author: Claude (Architect)
project: subcog
technologies:
  - rust
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0051: Feature-Gate Org-Scope Implementation

## Status

Accepted

## Context

The original architecture included an org-scope tier for shared PostgreSQL storage across teams. This enables:
- Shared decisions across organization
- Centralized backup and compliance
- Team knowledge aggregation

## Decision Drivers

### Primary Decision Drivers

1. **Future-Proofing**: Org-scope is a valuable feature but not immediately needed
2. **Development Focus**: Implementing org-scope now would delay core functionality
3. **Risk Management**: Feature gates allow safe rollout when ready

### Secondary Decision Drivers

1. **Configuration Flexibility**: Feature flags enable per-environment configuration
2. **Testing Isolation**: Disabled features don't need testing in every CI run

## Considered Options

### Option 1: Feature-Gate Org-Scope (Selected)

**Description**: Include org-scope interfaces in the design but disable implementation via feature flag.

**Advantages**:
- Future-proofs the architecture
- No immediate implementation burden
- Can be enabled when demand materializes

**Disadvantages**:
- Design complexity for unused feature
- May need redesign when actually implemented

### Option 2: Implement Org-Scope Now

**Description**: Build full org-scope implementation immediately.

**Advantages**:
- Feature available from launch

**Disadvantages**:
- Delays core functionality
- May build wrong thing without user feedback
- PostgreSQL dependency for all deployments

### Option 3: Remove Org-Scope from Design

**Description**: Do not include org-scope in architecture at all.

**Advantages**:
- Simplest design

**Disadvantages**:
- Retrofit later may require breaking changes
- Limits future capabilities

## Decision

We will **include org-scope in the design, but feature-gate the implementation**.

```rust
// config/features.rs
pub struct FeatureFlags {
    pub org_scope_enabled: bool,  // Default: false
    // ...
}
```

The architecture supports org-scope but it's disabled by default. When enabled:
- Requires PostgreSQL connection configuration
- Sync behavior TBD (push-only, pull-only, bidirectional)
- Admin controls for namespace visibility

## Consequences

### Positive

- Future-proofs the architecture
- No immediate implementation burden
- Can be enabled when demand materializes

### Negative

- Design complexity for unused feature
- May need redesign when actually implemented

### Neutral

- Mitigations available: Keep org-scope interfaces minimal and abstract; document intended behavior in ARCHITECTURE.md

## More Information

- **Date:** 2026-01-03
- **Source:** SPEC-2026-01-03-001: Storage Architecture Simplification

## Audit

**Date:** 2026-01-04

**Finding:** Compliant

**Remediation Completed:** 2026-01-04

**Evidence:**
- `src/config/features.rs` lines 1-66: FeatureFlags struct definition
  - **Missing:** `pub org_scope_enabled: bool` field specified in this ADR
  - **Present fields:** secrets_filter, pii_filter, multi_domain, audit_log, llm_features, auto_capture, consolidation
  - No org-scope feature gate exists

**Comment:** The org-scope feature flag was never implemented. The FeatureFlags struct omits the `org_scope_enabled` field entirely, meaning org-scope cannot be toggled at runtime as the ADR design specifies. This prevents safe rollout of org-scope features and makes it impossible to disable org-scope in environments where it's not needed.

**Remediation Completed:**
1. Added `pub org_scope_enabled: bool` to FeatureFlags (`src/config/features.rs:22`)
2. Set default to `false` in all constructors (none/core/all)
3. Field available for environment variable configuration
4. Feature flag in place for future org-scope initialization
5. Ready for org-scope implementation when needed

### 2026-01-04

**Status:** Partial

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| Org-scope feature flag is defined | `src/config/features.rs` | L16-L22 | compliant |
| Org-scope Cargo feature stub exists | `Cargo.toml` | L195-L211 | compliant |
| ServiceContainer accepts org_config without feature gating | `src/services/mod.rs` | L211-L234 | gap |

**Summary:** Org-scope is defined as a feature flag but not enforced in service initialization.

**Action Required:** Gate org-scope initialization behind org_scope_enabled or cfg(feature = "org-scope").

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| Org-scope feature flag defined and defaulted off | `src/config/features.rs` | L22-L37 | compliant |
| Org-scope initialization gated by feature flag/config | `src/services/mod.rs` | L233 | compliant |

**Summary:** Org-scope is feature-gated via config and service initialization checks.

**Action Required:** None
