---
title: "Feature-Gate Org-Scope Implementation"
description: "Include org-scope in the design but feature-gate the implementation for future enablement."
type: adr
category: architecture
tags:
  - org-scope
  - feature-flags
  - postgresql
  - future-proofing
status: published
created: 2026-01-03
updated: 2026-01-04
author: Claude (Architect)
project: subcog
technologies:
  - rust
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0051: Feature-Gate Org-Scope Implementation

## Status

Accepted

## Context

The original architecture included an org-scope tier for shared PostgreSQL storage across teams. This enables:
- Shared decisions across organization
- Centralized backup and compliance
- Team knowledge aggregation

## Decision

We will **include org-scope in the design, but feature-gate the implementation**.

```rust
// config/features.rs
pub struct FeatureFlags {
    pub org_scope_enabled: bool,  // Default: false
    // ...
}
```

The architecture supports org-scope but it's disabled by default. When enabled:
- Requires PostgreSQL connection configuration
- Sync behavior TBD (push-only, pull-only, bidirectional)
- Admin controls for namespace visibility

## Consequences

### Positive

- Future-proofs the architecture
- No immediate implementation burden
- Can be enabled when demand materializes

### Negative

- Design complexity for unused feature
- May need redesign when actually implemented

## Decision Outcome

Feature-gating allows the architecture to evolve without immediate implementation burden.

Mitigations:
- Keep org-scope interfaces minimal and abstract
- Document intended behavior in ARCHITECTURE.md

## More Information

- **Date:** 2026-01-03
- **Source:** SPEC-2026-01-03-001: Storage Architecture Simplification

## Audit

**Date:** 2026-01-04

**Finding:** ‚ùå **NON-COMPLIANT**

**Evidence:**
- `src/config/features.rs` lines 1-66: FeatureFlags struct definition
  - **Missing:** `pub org_scope_enabled: bool` field specified in this ADR
  - **Present fields:** secrets_filter, pii_filter, multi_domain, audit_log, llm_features, auto_capture, consolidation
  - No org-scope feature gate exists

**Comment:** The org-scope feature flag was never implemented. The FeatureFlags struct omits the `org_scope_enabled` field entirely, meaning org-scope cannot be toggled at runtime as the ADR design specifies. This prevents safe rollout of org-scope features and makes it impossible to disable org-scope in environments where it's not needed.

**Remediation Required:**
1. Add `pub org_scope_enabled: bool` field to FeatureFlags struct in `src/config/features.rs`
2. Set default value to `false` in FeatureFlags::default()
3. Add environment variable support: `SUBCOG_ORG_SCOPE_ENABLED`
4. Wire up feature check in org-scope initialization code (if exists)
5. Document org-scope configuration in CLAUDE.md and user docs
