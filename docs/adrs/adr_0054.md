---
title: "Notification Detection via id Field Absence"
description: "Detect JSON-RPC notifications by checking if the id field is absent (None) per JSON-RPC 2.0 spec."
type: adr
category: integration
tags:
  - json-rpc
  - mcp
  - notification
  - protocol
status: accepted
created: 2026-01-04
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0054: Notification Detection via `id` Field Absence

## Status

Accepted

## Context

We need to distinguish between JSON-RPC requests (which expect responses) and notifications (which must not receive responses). The JSON-RPC 2.0 specification defines this distinction.

## Decision Drivers

### Primary Decision Drivers

1. **Spec Compliance**: JSON-RPC 2.0 defines `id` absence as the notification signal
2. **Generality**: Works for all notification types, not just known ones
3. **Simplicity**: No struct changes needed

### Secondary Decision Drivers

1. **Maintainability**: No allowlist of notification methods to maintain
2. **Future-Proofing**: New notification types automatically handled

## Considered Options

### Option 1: Check `id` Field Absence (Selected)

**Description**: Check if `id` is `None` in the parsed `JsonRpcRequest`.

**Advantages**:
- Simple, spec-compliant detection
- No changes to `JsonRpcRequest` struct needed
- Works for all notification types, not just known ones

**Disadvantages**:
- None identified

### Option 2: Check Method Name Prefix

**Description**: Check if method starts with `notifications/*` or similar prefix.

**Advantages**:
- Explicit naming convention

**Disadvantages**:
- Not reliable - other protocols may use different conventions
- Not what the spec says
- Requires maintaining prefix list

### Option 3: Maintain Allowlist of Notification Methods

**Description**: Keep a list of known notification method names.

**Advantages**:
- Explicit control

**Disadvantages**:
- Over-engineered for this use case
- Requires maintenance as new notifications added
- Misses unknown notifications

## Decision

We will detect notifications by checking if the `id` field is absent (`None`) in the parsed `JsonRpcRequest`. This is the canonical method per JSON-RPC 2.0 spec.

## Consequences

### Positive

- Simple, spec-compliant detection
- No changes to `JsonRpcRequest` struct needed
- Works for all notification types, not just known ones

### Negative

- None identified

### Neutral

- Relies on serde correctly parsing missing `id` as `None`

## More Information

- **Date:** 2026-01-04
- **Source:** SPEC-2026-01-04-001: MCP Server JSON-RPC Notification Compliance
- **GitHub Issue:** [#46](https://github.com/zircote/subcog/issues/46)

## Audit

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| JsonRpcRequest::is_notification checks id is None | `src/mcp/server.rs` | L1025-L1041 | compliant |

**Summary:** Notifications are detected by missing id in JsonRpcRequest.

**Action Required:** None
