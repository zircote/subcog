---
title: "Always Include id in Error Responses"
description: "Modify format_error() to always include id field, using Value::Null for unknown requests per JSON-RPC 2.0."
type: adr
category: integration
tags:
  - json-rpc
  - mcp
  - error-handling
  - protocol
status: accepted
created: 2026-01-04
updated: 2026-01-04
author: Claude (Architect)
project: subcog
audience:
  - developers
  - architects
confidence: high
completeness: complete
---

# ADR-0056: Always Include `id` in Error Responses

## Status

Accepted

## Context

JSON-RPC 2.0 requires the `id` field in all response objects, including error responses. The current implementation uses `skip_serializing_if = "Option::is_none"` which omits `id` when it's `None`.

## Decision Drivers

### Primary Decision Drivers

1. **Spec Compliance**: JSON-RPC 2.0 requires `id` in all responses
2. **Client Compatibility**: Clients expect `id` to correlate responses
3. **Error Handling**: Parse errors need `id: null` per spec

### Secondary Decision Drivers

1. **Minimal Change**: One-line fix preferred over structural changes
2. **Consistency**: Error responses should match success response structure

## Considered Options

### Option 1: Modify format_error() to Always Include id (Selected)

**Description**: Use `id.unwrap_or(Value::Null)` to ensure `id` is always present.

**Advantages**:
- Compliant with JSON-RPC 2.0 specification
- Clients can parse error responses correctly
- Minimal code change (one line)

**Disadvantages**:
- None identified

### Option 2: Create Separate JsonRpcErrorResponse Struct

**Description**: Create a dedicated struct for error responses with required `id` field.

**Advantages**:
- Type-safe separation of success and error responses

**Disadvantages**:
- Over-engineered; the fix is one line
- More code to maintain

### Option 3: Remove skip_serializing_if Globally

**Description**: Remove the skip_serializing attribute so `id` is always serialized.

**Advantages**:
- Consistent serialization

**Disadvantages**:
- Would affect success responses unnecessarily
- May have unintended side effects

## Decision

We will modify `format_error()` to always include `id`. When the original request's `id` is unknown (e.g., parse errors), use `Value::Null` explicitly.

```rust
id: Some(id.unwrap_or(Value::Null))
```

## Consequences

### Positive

- Compliant with JSON-RPC 2.0 specification
- Clients can parse error responses correctly
- Minimal code change (one line)

### Negative

- None identified

### Neutral

- Success responses can continue to omit `id` if `None` (though this shouldn't happen in practice for valid requests)

## More Information

- **Date:** 2026-01-04
- **Source:** SPEC-2026-01-04-001: MCP Server JSON-RPC Notification Compliance
- **GitHub Issue:** [#46](https://github.com/zircote/subcog/issues/46)

## Audit

### 2026-01-04

**Status:** Compliant

**Findings:**

| Finding | Files | Lines | Assessment |
|---------|-------|-------|------------|
| format_error injects id or null | `src/mcp/server.rs` | L981-L990 | compliant |

**Summary:** Error responses always include id (or null) per JSON-RPC spec.

**Action Required:** None
