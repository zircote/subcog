# Central Event Bus for Memory Events

* Status: accepted
* Deciders: Subcog maintainers
* Date: 2026-01-04

## Context and Problem Statement

Subcog emits memory lifecycle events (capture, recall, consolidation, sync, GC).
Directly logging these events couples producers to a single sink and makes it
harder to add new subscribers (metrics, tracing, security audit).

## Decision Drivers

- Decouple producers from consumers
- Allow multiple subscribers without changing producers
- Support observability and audit logging
- Keep the implementation lightweight (no external broker)

## Considered Options

- Direct logging from each producer
- Tokio mpsc channel per consumer
- Tokio broadcast channel with a shared event bus
- External broker (Kafka, NATS)

## Decision Outcome

Chosen option: **Tokio broadcast channel with a shared event bus**.

Publish `MemoryEvent` to a global event bus. Consumers subscribe independently.
The audit logger subscribes and writes events to the audit log.

### Positive Consequences

- Producers are decoupled from consumers
- Multiple subscribers can consume events
- Audit logging and observability can evolve independently

### Negative Consequences

- Broadcast buffers can drop messages under pressure
- Requires a Tokio runtime for async subscriptions

## Links

- ADR-0004: `docs/adrs/adr_0004.md`
- Implementation: `src/observability/event_bus.rs`, `src/security/audit.rs`
